<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Signika&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    canvas {
      background: black;display: block;padding:0;margin: auto;
    }
  </style>
</head>
<body>
  <div class="jumbotron text-center" style="margin-bottom:30px">
    <h1 style="font-family:Signika">TIC-TAC-TOE</h1>
    <p>Two player tic-tac-toe game</p>
  </div>
  <canvas style="margin-bottom:30px" id="board" width="300" onclick="func(event)"height="300" float="right"></canvas>
  <p style="margin-bottom:30px;text-align:center" id="time"></p>
  <div class="container" style="font-family:Signika">
  <h2 style="text-align:center">Points Table</h2>
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Serial Number</th>
        <th>Result</th>
        <th>Cumultive Score of P1</th>
        <th> Cumulative Score of P2</th>
      </tr>
    </thead>
    <tbody id="tab">
    </tbody>
  </table>
</div>
  <script>
    var canvas = document.getElementById("board");
    var ctx = canvas.getContext("2d");
    ctx.strokeStyle = "white";
    ctx.moveTo(100,0);
    ctx.lineTo(100,300);
    ctx.moveTo(200,0);
    ctx.lineTo(200,300);
    ctx.moveTo(300,0);
    ctx.lineTo(300,300);
    ctx.moveTo(0,100);
    ctx.lineTo(300,100);
    ctx.moveTo(0,200);
    ctx.lineTo(300,200);
    ctx.moveTo(0,300);
    ctx.lineTo(300,300);
    ctx.stroke();
    ctx.closePath();
    var timer_running=0;
    var timeleft=5;
    var answer;
    function timer(){
    var downloadTimer = setInterval(function(){
  document.getElementById("time").innerHTML = answer +"! "+"Starting a new game in "+timeleft+" seconds";
  timeleft -= 1;
  if((timeleft < 0)||(timer_running==0)){
    clearInterval(downloadTimer);
    document.getElementById("time").innerHTML = ""
    timeleft=5;
    timer_running=0;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    redraw();
  }
}, 1000);
}
    function draw_circle(x,y){
      var a=x/100;
      var b=y/100;
      a=Math.floor(a);
      b=Math.floor(b);
      a=a*100;
      b=b*100;
      ctx.beginPath();
      ctx.arc(a+50, b+50, 40, 0, 2 * Math.PI);
      ctx.stroke();
      ctx.closePath();
    }
    function redraw(){
      ctx.beginPath();
      ctx.moveTo(100,0);
      ctx.lineTo(100,300);
      ctx.moveTo(200,0);
      ctx.lineTo(200,300);
      ctx.moveTo(300,0);
      ctx.lineTo(300,300);
      ctx.moveTo(0,100);
      ctx.lineTo(300,100);
      ctx.moveTo(0,200);
      ctx.lineTo(300,200);
      ctx.moveTo(0,300);
      ctx.lineTo(300,300);
      ctx.stroke();
      ctx.closePath();
    }
    function draw_cross(x,y){
      var a=x/100;
      var b=y/100;
      a=Math.floor(a);
      b=Math.floor(b);
      a=a*100;
      b=b*100;
      ctx.beginPath();
      ctx.moveTo(a+10,b+10);
      ctx.lineTo(a+90,b+90);
      ctx.moveTo(a+90,b+10);
      ctx.lineTo(a+10,b+90);
      ctx.stroke();
      ctx.closePath();
    }
    function get_box(x,y){
      var a=x/100;
      var b=y/100;
      a=Math.floor(a);
      b=Math.floor(b);
      return a+3*b;
    }

    var state=[-1,-1,-1,-1,-1,-1,-1,-1,-1];
    var present=0;
    var game_number=1;
    var cum=[0,0];
    var move_number=0;
    function topu(arr,x){
      if((arr[0]==x)&&(arr[1]==x)&&(arr[2]==x)){
        return x;
      }
      if((arr[3]==x)&&(arr[4]==x)&&(arr[5]==x)){
        return x;
      }
      if((arr[6]==x)&&(arr[7]==x)&&(arr[8]==x)){
        return x;
      }
      if((arr[0]==x)&&(arr[3]==x)&&(arr[6]==x)){
        return x;
      }
      if((arr[1]==x)&&(arr[4]==x)&&(arr[7]==x)){
        return x;
      }
      if((arr[2]==x)&&(arr[5]==x)&&(arr[8]==x)){
        return x;
      }
      if((arr[0]==x)&&(arr[4]==x)&&(arr[8]==x)){
        return x;
      }
      if((arr[2]==x)&&(arr[4]==x)&&(arr[6]==x)){
        return x;
      }
      return -1;
    }
    function f1(arr1,pre){
      var arr=arr1.slice(0);
      var total=[0,0];
      var remaining=[];
      for(let i=0;i<9;i++){
        if(arr[i]==-1){
          remaining.push(i);
        }
      }
      function perm(xs) {
  let ret = [];

  for (let i = 0; i < xs.length; i = i + 1) {
    let rest = perm(xs.slice(0, i).concat(xs.slice(i + 1)));

    if(!rest.length) {
      ret.push([xs[i]])
    } else {
      for(let j = 0; j < rest.length; j = j + 1) {
        ret.push([xs[i]].concat(rest[j]))
      }
    }
  }
  return ret;
}
    var all_possible=perm(remaining);
    var len1=all_possible.length;
    var len2=remaining.length;
    for(let j=0;j<len1;j++){
      var x=arr.slice(0);
      var y=pre;
      for(let k=0;k<len2;k++){
        x[((all_possible[j])[k])]=y;
        var wajid=topu(x,y);
        if(wajid==y){
          total[y]++;
          break;
        }
        y=(y+1)%2;
      }
    }
    var first=total[0];
    var second=total[1];
    var tie=len1-first-second;

    if((first==0)&&(second==0)){
      return 2;
    }
    if((first==0)&&(tie==0)){
      return 1;
    }
    if((second==0)&&(tie==0)){
      return 0;
    }
    return -1;
    }
    function check2(box){
      var temp=state.slice(0);
      var basic=f1(temp,present);
      var pre_move=(present+1)%2;
      var anmol=topu(temp,pre_move);
      if(anmol!=-1){
        check(box);
        return;
      }
      if(move_number==9){
        var math=topu(temp,pre_move);
        if(math==pre_move){
          state[0]=pre_move;
          state[1]=pre_move;
          state[2]=pre_move;
          check(0);
        }
        else{
          state[0]=pre_move;
          state[3]=present;
          state[6]=present;
          state[1]=present;
          state[4]=pre_move;
          state[7]=pre_move;
          state[2]=pre_move;
          state[5]=pre_move;
          state[8]=present;
          move_number=9;
          check(3);
        }
      }
      var sajid=basic;
      if(sajid==1){
        present=0;
        state[0]=1;
        state[1]=1;
        state[2]=1;
        check(0);
      }
      if(sajid==0){
        present=1;
        state[0]=0;
        state[1]=0;
        state[2]=0;
        check(0);
      }
      if(sajid==2){
        state[0]=pre_move;
        state[3]=present;
        state[6]=present;
        state[1]=present;
        state[4]=pre_move;
        state[7]=pre_move;
        state[2]=pre_move;
        state[5]=pre_move;
        state[8]=present;
        move_number=9;
        check(3);
      }
    }

    function check(box){
      var row=Math.floor(box/3);
      var col=Math.floor(box%3);
      var temp=(present+1)%2;
      var temp1=3*row;
      temp++;
      var tempe=temp.toString();
      temp--;
      var tempo="Player " + tempe + " won ";
      if((state[temp1]==temp)&&(state[temp1+1]==temp)&&(state[temp1+2]==temp)){
        state = state.map(x => -1);
        game_number=game_number+1;
        if(game_number%2==0){
          present=1;
        }
        else{
          present=0;
        }
        timer_running=1;
        answer=tempo;
        cum[temp]=cum[temp]+4;
        game_number--;
        document.getElementById("tab").innerHTML=document.getElementById("tab").innerHTML+"<tr><td>"+game_number+"</td><td>"+tempe+"</td><td>"+cum[0]+"</td><td>"+cum[1]+"</td></tr>";
        game_number++;
        timer();


        move_number=0;
        return;
      }
      if((state[col]==temp)&&(state[col+3]==temp)&&(state[col+6]==temp)){
        state = state.map(x => -1);
        game_number=game_number+1;
        if(game_number%2==0){
          present=1;
        }
        else{
          present=0;
        }
        timer_running=1;
        answer=tempo;
        cum[temp]=cum[temp]+4;
        game_number--;
        document.getElementById("tab").innerHTML=document.getElementById("tab").innerHTML+"<tr><td>"+game_number+"</td><td>"+tempe+"</td><td>"+cum[0]+"</td><td>"+cum[1]+"</td></tr>";
        game_number++;
        timer();


        move_number=0;
        return;
      }
      if((state[0]==temp)&&(state[4]==temp)&&(state[8]==temp)){
        state = state.map(x => -1);
        game_number=game_number+1;
        if(game_number%2==0){
          present=1;
        }
        else{
          present=0;
        }
        timer_running=1;
        answer=tempo;
        cum[temp]=cum[temp]+4;
        game_number--;
        document.getElementById("tab").innerHTML=document.getElementById("tab").innerHTML+"<tr><td>"+game_number+"</td><td>"+tempe+"</td><td>"+cum[0]+"</td><td>"+cum[1]+"</td></tr>";
        game_number++;
        timer();


        move_number=0;
        return;
      }
      if((state[2]==temp)&&(state[4]==temp)&&(state[6]==temp)){
        state = state.map(x => -1);
        game_number=game_number+1;
        if(game_number%2==0){
          present=1;
        }
        else{
          present=0;
        }
        timer_running=1;
        answer=tempo;
        cum[temp]=cum[temp]+4;
        game_number--;
        document.getElementById("tab").innerHTML=document.getElementById("tab").innerHTML+"<tr><td>"+game_number+"</td><td>"+tempe+"</td><td>"+cum[0]+"</td><td>"+cum[1]+"</td></tr>";
        game_number++;
        timer();
        move_number=0;
        return;
      }
      if(move_number==9){
        state = state.map(x => -1);
        game_number=game_number+1;
        if(game_number%2==0){
          present=1;
        }
        else{
          present=0;
        }
        timer_running=1;
        answer="Match Tied ";
        cum[0]=cum[0]+1;
        cum[1]=cum[1]+1;
        game_number--;
        document.getElementById("tab").innerHTML=document.getElementById("tab").innerHTML+"<tr><td>"+game_number+"</td><td>T</td><td>"+cum[0]+"</td><td>"+cum[1]+"</td></tr>";
        game_number++;
        timer();
        move_number=0;
        return;
      }
    }
    function func(event){
      if(timer_running==1){
        timer_running=0;
      }
      else{
      var x=event.offsetX;
      var y=event.offsetY;
      var box=get_box(x,y);
      if(state[box]!=-1){
        return;
      }
      else{
        move_number++;
        if(present==0){
          state[box]=0;
          if(game_number%2==1){
            draw_cross(x,y);
          }
          else{
            draw_circle(x,y);
          }
          present=1;
          check2(box);
        }
        else{
          state[box]=1;
          if(game_number%2==1){
            draw_circle(x,y);
          }
          else{
            draw_cross(x,y);
          }
          present=0;
          check2(box);
        }
      }
    }
  }
    </script>
  </body>
  </html>
